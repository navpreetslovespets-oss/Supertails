
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AHS – At Home Care Service • Interactive Flow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts -->
  <link href="https://unpkg.com/@fontsource-variable/inter@5.0.21/index.css" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1221;
      --panel:#151936;
      --ink:#e8ecff;
      --muted:#a8b0d4;
      --ops:#2dd4bf;        /* teal */
      --tech:#60a5fa;       /* blue */
      --people:#f59e0b;     /* amber */
      --finance:#f472b6;    /* pink */
      --cx:#a78bfa;         /* violet */
      --vacc:#34d399;       /* emerald */
      --cons:#22d3ee;       /* cyan */
      --accent:#7c3aed;     /* purple */
    }
    html,body,#root{height:100%; margin:0;}
    body{background:var(--bg); color:var(--ink); font-family:"InterVariable", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}
    .app{
      height:100%;
      display:grid;
      grid-template-rows:auto 1fr;
      gap:8px;
    }
    .topbar{
      display:flex; align-items:center; gap:12px; padding:12px 16px;
      background: linear-gradient(180deg, rgba(124,58,237,0.25), rgba(21,25,54,0.7));
      border-bottom:1px solid rgba(124,58,237,0.35);
      backdrop-filter: blur(6px);
      position:sticky; top:0; z-index:10;
    }
    .title{
      font-weight:700; letter-spacing:.2px;
    }
    .tag{
      font-size:12px; color:var(--muted); background:rgba(124,58,237,.2); border:1px solid rgba(124,58,237,.4);
      padding:4px 8px; border-radius:999px;
    }
    .controls{margin-left:auto; display:flex; align-items:center; gap:10px;}
    .chip{
      display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none;
      padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.04);
      transition:.2s ease;
    }
    .chip input{accent-color:var(--accent);}
    .chip:hover{background:rgba(255,255,255,.08);}
    .legend{display:flex; gap:8px; align-items:center; margin-left:8px;}
    .dot{width:10px; height:10px; border-radius:50%;}
    .panel{
      position:absolute; top:70px; right:16px; z-index:5;
      background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:14px;
      padding:10px; display:flex; flex-direction:column; gap:8px;
      box-shadow: 0 8px 28px rgba(0,0,0,.35);
    }
    .panel h4{margin:0 0 4px 0; font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.12em}
    .btn{
      border:1px solid rgba(255,255,255,.14); border-radius:10px; padding:8px 10px; background:rgba(255,255,255,.04); color:var(--ink);
      cursor:pointer; font-weight:600;
    }
    .btn:hover{background:rgba(255,255,255,.08)}
    .react-flow__attribution{display:none;}
  </style>
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- React Flow -->
  <link rel="stylesheet" href="https://unpkg.com/reactflow@11.10.4/dist/style.css" />
  <script src="https://unpkg.com/reactflow@11.10.4/dist/react-flow.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/javascript">
  const { createElement: h, useState, useMemo, useCallback } = React;
  const { createRoot } = ReactDOM;
  const {
    ReactFlow, Background, Controls, MiniMap,
    useNodesState, useEdgesState, MarkerType
  } = ReactFlow;

  // Base nodes (departments)
  const deptNodes = [
    { id: 'ops', position: { x: 0, y: 0 }, data: { label: 'Operations' }, style: { background: 'var(--ops)', color:'#081018', fontWeight:700 }, type: 'input' },
    { id: 'tech', position: { x: 280, y: 0 }, data: { label: 'Technology' }, style: { background: 'var(--tech)', color:'#081018', fontWeight:700 } },
    { id: 'finance', position: { x: 560, y: 0 }, data: { label: 'Finance' }, style: { background: 'var(--finance)', color:'#081018', fontWeight:700 } },
    { id: 'cx', position: { x: 840, y: 0 }, data: { label: 'Customer Experience' }, style: { background: 'var(--cx)', color:'#081018', fontWeight:700 } },
    { id: 'people', position: { x: 1120, y: 0 }, data: { label: 'People' }, style: { background: 'var(--people)', color:'#081018', fontWeight:700 }, type: 'output' },
  ];

  // Operational steps (shared)
  const baseSteps = [
    { id: 'lead', position: { x: 0, y: 150 }, data: { label: 'Lead / Booking (App/CRM)' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
    { id: 'schedule', position: { x: 240, y: 150 }, data: { label: 'Scheduling (Ops)' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
    { id: 'precall', position: { x: 480, y: 150 }, data: { label: 'Pre-Visit Call (30 min)' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
    { id: 'travel', position: { x: 720, y: 150 }, data: { label: 'In Transit → Onsite' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
    { id: 'inconsult', position: { x: 960, y: 150 }, data: { label: 'Mark “In Consult” + SOAP' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
    { id: 'payment', position: { x: 1200, y: 150 }, data: { label: 'Payment → Link/QR + UTR' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
    { id: 'recon', position: { x: 1440, y: 150 }, data: { label: 'Finance Reconciliation' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
    { id: 'feedback', position: { x: 1680, y: 150 }, data: { label: 'CX Feedback / NPS' }, style: { background:'#20254a', color:'#e8ecff', border:'1px solid rgba(255,255,255,.08)' } },
  ];

  // Branch nodes for service type
  const vaccNodes = [
    { id: 'vacc', position: { x: 960, y: 270 }, data: { label: 'Vaccination Protocol ✓' }, style: { background:'var(--vacc)', color:'#05140e', fontWeight:700 } },
  ];
  const consNodes = [
    { id: 'cons', position: { x: 960, y: 270 }, data: { label: 'Consultation Protocol ✓' }, style: { background:'var(--cons)', color:'#041216', fontWeight:700 } },
  ];

  // Helper to create edges
  function edge(id, s, t, label, color='rgba(255,255,255,.6)'){
    return {
      id, source: s, target: t,
      label, style: { stroke: color }, labelStyle: { fill:'#e8ecff', fontWeight:600, fontSize:12 },
      animated: true,
      markerEnd: { type: MarkerType.ArrowClosed, color }
    }
  }

  // Department edges
  const deptEdges = [
    edge('e1', 'ops', 'tech', 'App status + APIs', 'var(--tech)'),
    edge('e2', 'tech', 'finance', 'Payment events', 'var(--finance)'),
    edge('e3', 'finance', 'cx', 'Refunds/NPS linkage', 'var(--cx)'),
    edge('e4', 'cx', 'people', 'Feedback → Training', 'var(--people)'),
    edge('e5', 'people', 'ops', 'Roster & SOP', 'var(--ops)'),
  ];

  // Base operational edges
  const baseEdges = [
    edge('b1','lead','schedule','SLAs'),
    edge('b2','schedule','precall','T-30'),
    edge('b3','precall','travel','Route'),
    edge('b4','travel','inconsult','Arrive'),
    edge('b5','inconsult','payment','Close'),
    edge('b6','payment','recon','UTR'),
    edge('b7','recon','feedback','NPS'),
  ];

  function App(){
    const [showVacc, setShowVacc] = React.useState(true);
    const [showCons, setShowCons] = React.useState(true);

    const nodes = useMemo(()=>{
      const list = [...deptNodes, ...baseSteps];
      if(showVacc) list.push(...vaccNodes);
      if(showCons) list.push(...consNodes);
      return list.map(n => ({ ...n, draggable: false }));
    }, [showVacc, showCons]);

    const edges = useMemo(()=>{
      const list = [...deptEdges, ...baseEdges];
      if(showVacc) list.push(edge('sv','inconsult','vacc','Dose, AEFI, records','var(--vacc)'));
      if(showCons) list.push(edge('sc','inconsult','cons','Dx, Rx, plan','var(--cons)'));
      return list;
    }, [showVacc, showCons]);

    const onReset = useCallback(()=>{
      location.reload();
    },[]);

    const onExport = useCallback(()=>{
      // simple PNG export via HTML2Canvas would require extra CDN; provide JSON instead
      const data = { nodes, edges, ts: Date.now(), version: '1.0' };
      const blob = new Blob([JSON.stringify(data,null,2)], { type:'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'ahs-flow-export.json'; a.click();
      URL.revokeObjectURL(url);
    },[nodes,edges]);

    return h('div', { className:'app' },
      h('div', { className:'topbar' },
        h('div', { className:'title' }, 'AHS – At Home Care Service • Interactive Flow'),
        h('span', { className:'tag' }, 'Vaccination & Consultation'),
        h('div', { className:'legend' },
          h('span', { className:'dot', style:{ background:'var(--ops)' }}), h('small', null, 'Ops'),
          h('span', { className:'dot', style:{ background:'var(--tech)' }}), h('small', null, 'Tech'),
          h('span', { className:'dot', style:{ background:'var(--finance)' }}), h('small', null, 'Finance'),
          h('span', { className:'dot', style:{ background:'var(--cx)' }}), h('small', null, 'CX'),
          h('span', { className:'dot', style:{ background:'var(--people)' }}), h('small', null, 'People'),
        ),
        h('div', { className:'controls' },
          h('label', { className:'chip' },
            h('input', { type:'checkbox', checked: showVacc, onChange: e=>setShowVacc(e.target.checked) }),
            h('span', null, 'Vaccination Branch')
          ),
          h('label', { className:'chip' },
            h('input', { type:'checkbox', checked: showCons, onChange: e=>setShowCons(e.target.checked) }),
            h('span', null, 'Consultation Branch')
          )
        ),
      ),
      h('div', { style:{ position:'relative', height:'100%' } },
        h('div', { className:'panel' },
          h('h4', null, 'Actions'),
          h('button', { className:'btn', onClick:onReset }, 'Reset View'),
          h('button', { className:'btn', onClick:onExport }, 'Export JSON')
        ),
        h(ReactFlow, {
          nodes, edges, fitView: true, proOptions:{ hideAttribution: true }
        },
          h(Background, { variant:'lines' }),
          h(Controls, null),
          h(MiniMap, { pannable:true, zoomable:true })
        )
      )
    );
  }

  createRoot(document.getElementById('root')).render(h(App));
  </script>
</body>
</html>
